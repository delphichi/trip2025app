<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶æ—å¿«æ¨‚ä¹‹æ—…</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#7CFC00">
</head>
<body>

    <header class="app-header">
        <h1>2025 å¹´ VIÃ‘A / CHILLAN å¿«æ¨‚ä¹‹æ—…</h1>
        <p class="subtitle">8 å¤© 7 å¤œ å®¶æ—å°ˆå±¬è¡Œç¨‹</p>
    </header>

    <main class="trip-schedule" id="trip-schedule-container">
        <h2>æ­£åœ¨è¼‰å…¥æœ€æ–°çš„å®¶æ—è¡Œç¨‹è¡¨...</h2>
        <p>å¦‚æœé•·æ™‚é–“æœªé¡¯ç¤ºå…§å®¹ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ– Apps Script é€£çµã€‚</p>
    </main>
    
    <script>
        // *** æ­¥é©Ÿ 1: è¨­å®šæ‚¨çš„ Apps Script API é€£çµ ***
        const API_URL = 'https://script.google.com/macros/s/AKfycbzEf0mvIlEQI1pVBALtUz5kr2l9Q08P2z4aiZyES__a3Sl0KMswKHbyq2bf83WTkYeA5g/exec'; 

        // ==========================================================
        // è³‡æ–™è™•ç†ï¼šå°‡æ‰å¹³çš„è©¦ç®—è¡¨è³‡æ–™ä¾ã€Œå¤©æ•¸ã€æˆ–ã€Œæ—¥æœŸã€åˆ†çµ„
        // ==========================================================
        function groupDataByDay(data) {
            const grouped = {};
            data.forEach(item => {
                // ä½¿ç”¨ DATE æ¬„ä½ä½œç‚ºåˆ†çµ„éµ (ç¢ºä¿å…¶å­˜åœ¨ä¸”å”¯ä¸€)
                const dayKey = item.DATE || item.DAY; 
                if (!dayKey) return; 

                if (!grouped[dayKey]) {
                    grouped[dayKey] = {
                        day: item.DAY,
                        date: item.DATE,
                        activities: []
                    };
                }
                grouped[dayKey].activities.push(item);
            });
            return Object.values(grouped);
        }

        // ==========================================================
        // ä»‹é¢ç”Ÿæˆï¼šæ ¹æ“šåˆ†çµ„å¾Œçš„è³‡æ–™ç”Ÿæˆ HTML çµæ§‹
        // ==========================================================
        function generateDayCardHTML(groupedData) {
            let htmlContent = '';
            
            groupedData.forEach(dayGroup => {
                let activitiesHtml = '';
                
                dayGroup.activities.forEach(item => {
                    // *** ç¢ºä¿é€™è£¡ä½¿ç”¨çš„å±¬æ€§åç¨±èˆ‡ Google Sheet æ¬„ä½åç¨±å®Œå…¨åŒ¹é… (ä¾‹å¦‚ï¼šitem.Activity) ***
                    
                    // è¡Œç¨‹æ´»å‹•å¡ç‰‡
                    if (item.Activity) {
                        activitiesHtml += `
                            <div class="activity">
                                <span class="time">${item.TIME || 'è¡Œç¨‹'}</span>
                                <p>
                                    <strong>${item.Activity}</strong> 
                                    ${item.Description ? `- ä»‹ç´¹ï¼š${item.Description}` : ''}
                                </p>
                            </div>
                        `;
                    }

                    // é¤é£²å¡ç‰‡ (ä¸­é¤)
                    if (item.LUNCH) {
                        activitiesHtml += `
                            <div class="activity meal">
                                <span class="time">ä¸­é¤</span>
                                <p>${item.LUNCH}</p>
                            </div>
                        `;
                    }
                    
                    // é¤é£²å¡ç‰‡ (æ™šé¤)
                    if (item.DINNER) {
                        activitiesHtml += `
                            <div class="activity meal">
                                <span class="time">æ™šé¤</span>
                                <p>${item.DINNER}</p>
                            </div>
                        `;
                    }
                });
                
                // æ¯å€‹æ—¥æœŸçš„ä¸»å¡ç‰‡
                htmlContent += `
                    <section class="day-card">
                        <h2 class="day-title">
                            ğŸ“† ç¬¬ ${dayGroup.day || '?'} å¤©ï¼š${dayGroup.date || 'æ—¥æœŸæœªå®š'}
                        </h2>
                        <div class="activity-list">
                            ${activitiesHtml}
                        </div>
                    </section>
                `;
            });
            
            return htmlContent;
        }

        // ==========================================================
        // ä¸»è¦åŸ·è¡Œï¼šæŠ“å–è³‡æ–™èˆ‡æ¸²æŸ“
        // =================

